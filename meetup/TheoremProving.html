<!DOCTYPE html>
<html lang="en">
<head>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106754474-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-106754474-1');
</script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>Liquid Haskell</title>

    <link href="./css/bootstrap.css" rel="stylesheet">
    <link href="./css/bootstrap-theme.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./css/rust-book.css">
    <link rel="stylesheet" type="text/css" href="./css/editor.css">

   
    <style type="text/css">code{white-space: pre;}

      .dropdown-menu {
          min-width: 0px;
      }
      
      #checker-status {
          width: 30;
          height: 20;
          padding-top: 2px;
          padding-right: 10px;
          position: absolute;
          top: 0;
          right: 0;
          z-index:99;
      }
    </style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>


<!-- <script type="text/javascript" src="js/jquery/jquery-1.7.1.min.js"></script> -->
<script type="text/javascript" src="./js/jquery/jquery-2.0.3.min.js"></script>
<script type="text/javascript" src="./js/angular/angular.js"></script>
<script type="text/javascript" src="./js/bootstrap/bootstrap.js"></script>

<!-- MATHJAX TEMPLATES GO HERE -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
    extensions: ["color.js"],
    Macros: {
      True: "\\mathit{True}",
      RR:   "{\\bf R}",
      Int:  "\\mathtt{Int}",
      Nat:  "\\mathtt{Nat}",
      Zero: "\\mathtt{Zero}",
      foo:   ["{\\bf Jhala FOO #1}", 1],
      kvar:  ["{\\color[rgb]{1,0,0}{K_{#1}({#2})}}", 2],
      bindx: ["{{#1}\\!:\\!{#2}}", 2],
      reft:  ["\\{\\bindx{#1}{#2} \\mid {#3}\\}", 3],
      ereft: ["\\bindx{#1}{\\{#2 \\mid #3\\}}", 3],
      reftx: ["\\{{#1}\\mid{#2}\\}", 2],
      inferrule: ["\\frac{#2}{#3}\\;{#1}", 3],
      tcap:  ["(\\mathtt{intersection}\\ #1\\ #2)", 2],
      tcup:  ["(\\mathtt{union}\\ #1\\ #2)", 2],
      tsng:  ["(\\mathtt{singleton}\\ #1)", 1]
  }
  }
});
</script>

<!-- GITHUB -->
<script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript"></script>
  
<!-- LOCAL 

  <script src="js/MathJax-2.6.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
    type="text/javascript"></script>
    
  -->
  







</head>
<body class="rustdoc" data-spy="scroll" data-target=".bs-docs-sidebar" ng-app="liquidDemo" ng-controller="LiquidDemoCtrl">

    <div id="nav">
       <button id="toggle-nav" class="toggle-nav">
         <span class="sr-only">Toggle navigation</span>
         <span class="bar"></span>
         <span class="bar"></span>
         <span class="bar"></span>
       </button>
    </div>

<div id='toc' class='mobile-hidden'>
<ul class='chapter'>
<li><a href='HaskellMeetup.html'><b>1.</b>Refinement Types</a></li>
<ul class='section'>
<li><a href='HaskellMeetup.html#'><b>1.1.</b> Liquid Haskell</a></li>
<li><a href='HaskellMeetup.html#'><b>1.2.</b> Basic Types</a></li>
<li><a href='HaskellMeetup.html#'><b>1.3.</b> Pre- and Post-Conditions</a></li>
<li><a href='HaskellMeetup.html#'><b>1.4.</b> Recursive Functions</a></li>
<li><a href='HaskellMeetup.html#'><b>1.5.</b> Summary</a></li>
</ul>
<li><a href='TheoremProving.html'><b>2.</b>Deep Verification</a></li>
<ul class='section'>
<li><a href='TheoremProving.html#'><b>2.1.</b> Equational Proofs</a></li>
<li><a href='TheoremProving.html#'><b>2.2.</b> MapReduce Definition</a></li>
<li><a href='TheoremProving.html#'><b>2.3.</b> Map Reduce Example Client:</a></li>
<li><a href='TheoremProving.html#'><b>2.4.</b> Proving Code Equivalence: <code>sum</code> and <code>psum</code></a></li>
<li><a href='TheoremProving.html#'><b>2.5.</b> Higher Order Map Reduce Theorem</a></li>
<li><a href='TheoremProving.html#'><b>2.6.</b> Summary</a></li>
<li><a href='TheoremProving.html#'><b>2.7.</b> Missing Code</a></li>
</ul>
</ul>

</div>
      
       <div id="checker-status">
         <!-- Verifying ... -->
         <button class="btn btn-xs btn-link actbutton" type="button" style="font-size:30px; z-index:1"
                ng-show="isChecking" ng-click="verifySource()">
          <span class="glyphicon glyphicon-hourglass"></span>
         </button>

        
         <!-- Safe -->
         <button class="btn btn-xs btn-link actbutton" type="button" style="font-size:30px; color:green; z-index:1"
                 ng-show="isSafe">
           <span class="glyphicon glyphicon-ok"></span>
         </button>

         <div class="dropdown" ng-show="isBad">
             <button class="btn btn-xs btn-link dropdown-toggle"
                     type="button"
                     id="errorblockdropdown"
                     data-toggle="dropdown"
                     style="font-size:30px; color:red; z-index:1">
               <span class="glyphicon glyphicon-remove" style="vertical-align:middle"></span><font size="4">{{errorBlocks.length}}</font>
               </span>
             </button>
             <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
               <li ng-repeat="err in errorBlocks">
                 <a tabindex="-1" ng-href="#program-{{err.data}}">{{err.index}}</a>
               </li>
             </ul>
         </div>
       </div>
       

<div id='page-wrapper'>
<div id='page'>

<section id="deep-verification" class="level1">
<h1>Deep Verification</h1>
<p>Let’s now use Liquid Haskell to prove theorems about Haskell functions! To do so, we need to activate two flags: <code>--reflection</code> and <code>--ple</code>.</p>
<div id="program-pane-0" class="welleditor" style="background:#fff; position:relative">

  <!-- Verify Source -->
  <button class="btn btn-xs btn-link actbutton" type="button" style="z-index:1"
          ng-show="isUnknown" ng-click="verifySource()">
    <span class="glyphicon glyphicon-play"></span>
  </button>
 
  <div id="program-0" class="programbox">module TheoremProving where

{-@ LIQUID "--reflection" @-}
{-@ LIQUID "--ple"        @-}
{-@ infix ++ @-}
import Language.Haskell.Liquid.ProofCombinators

import Prelude hiding (take, drop, (++), map, sum, length)</div>
</div>

<section id="equational-proofs" class="level2">
<h2>Equational Proofs</h2>
<p>The <code>--reflection</code> flag allows us to reflect Haskell functions into logic, that is we can then use them in refinements.</p>
<div id="program-pane-1" class="welleditor" style="background:#fff; position:relative">

  <!-- Verify Source -->
  <button class="btn btn-xs btn-link actbutton" type="button" style="z-index:1"
          ng-show="isUnknown" ng-click="verifySource()">
    <span class="glyphicon glyphicon-play"></span>
  </button>
 
  <div id="program-1" class="programbox">{-@ reflect ++ @-}
(++) :: [a] -> [a] -> [a]
[]     ++ ys = ys
(x:xs) ++ ys = x : (xs ++ ys)</div>
</div>

<p>Now that <code>++</code> is reflected, we can use it in the refinements and prove theorems about append!</p>
<p>Let’s prove right identity:</p>
<div id="program-pane-2" class="welleditor" style="background:#fff; position:relative">

  <!-- Verify Source -->
  <button class="btn btn-xs btn-link actbutton" type="button" style="z-index:1"
          ng-show="isUnknown" ng-click="verifySource()">
    <span class="glyphicon glyphicon-play"></span>
  </button>
 
  <div id="program-2" class="programbox">{-@ rightId :: xs:[a] -> {v:() | xs ++ [] == xs } @-}
rightId :: [a] -> () 
rightId = undefined </div>
</div>

<p>The theorem is a unit type (i.e., has no computational content) but it is refined to curry the proof statement. We can simplify the statement by removing the unit type and the value <code>v</code>, when they are not required.</p>
<p>The proof is an inhabitant of the theorem and is implemented using functions from the <a href="https://hackage.haskell.org/package/liquidhaskell-0.8.0.5/docs/src/Language-Haskell-Liquid-ProofCombinators.html">proof combinators</a> library.</p>
<p>Most of the equational steps can be simplified by PLE (<a href="https://dl.acm.org/doi/10.1145/3158141">Proof by Logical Evaluation</a>)!</p>
<p>Let’s now prove the take-drop reconstruction property (<code>take</code> and <code>drop</code> are defined as before, but now reflected!)</p>
<div id="program-pane-3" class="welleditor" style="background:#fff; position:relative">

  <!-- Verify Source -->
  <button class="btn btn-xs btn-link actbutton" type="button" style="z-index:1"
          ng-show="isUnknown" ng-click="verifySource()">
    <span class="glyphicon glyphicon-play"></span>
  </button>
 
  <div id="program-3" class="programbox">{-@ appendTakeDrop :: i:Nat -> xs:{[a] | i <= len xs} ->
     {xs == (take i xs) ++ (drop i xs) }  @-}
appendTakeDrop :: Int -> [a] -> () 
appendTakeDrop = undefined</div>
</div>

</section>
<section id="mapreduce-definition" class="level2">
<h2>MapReduce Definition</h2>
<p>As a bigger example, let’s look into the <code>mapReduce</code> function.</p>
<p>The goal is to apply a function <code>f</code> to a list of elements. But instead of applying it directly, we first chunk the list into smaller lists of size <code>n</code>, then apply <code>f</code> to each chunk, and finally reduce the results using an operator <code>op</code>.</p>
<div id="program-pane-4" class="welleditor" style="background:#fff; position:relative">

  <!-- Verify Source -->
  <button class="btn btn-xs btn-link actbutton" type="button" style="z-index:1"
          ng-show="isUnknown" ng-click="verifySource()">
    <span class="glyphicon glyphicon-play"></span>
  </button>
 
  <div id="program-4" class="programbox">{-@ reflect mapReduce @-}
mapReduce :: Int -> ([a] -> b) -> (b -> b -> b) -> [a] -> b 
mapReduce n f op is = reduce op (f []) (map f (chunk n is))

{-@ reflect reduce @-}
reduce :: (a -> a -> a) -> a -> [a] -> a 
reduce op b []     = b 
reduce op b (x:xs) = op x (reduce op b xs) 

{-@ reflect map @-}
map :: (a -> b) -> [a] -> [b]
map _  []    = []
map f (x:xs) = f x:map f xs 

{-@ reflect chunk @-}
chunk :: Int -> [a] -> [[a]]</div>
</div>

</section>
<section id="map-reduce-example-client" class="level2">
<h2>Map Reduce Example Client:</h2>
<p>As an example, we can use <code>mapReduce</code> to define a function <code>psum</code> that “in parallel” computes the sum of a list of integers.</p>
<div id="program-pane-5" class="welleditor" style="background:#fff; position:relative">

  <!-- Verify Source -->
  <button class="btn btn-xs btn-link actbutton" type="button" style="z-index:1"
          ng-show="isUnknown" ng-click="verifySource()">
    <span class="glyphicon glyphicon-play"></span>
  </button>
 
  <div id="program-5" class="programbox">{-@ reflect sum @-}
sum  :: [Int] -> Int 
sum []        = 0 
sum (x:xs) = x `plus` sum xs

{-@ reflect plus @-}
plus :: Int -> Int -> Int 
plus x y = x + y 

{-@ reflect psum @-}
psum :: Int -> [Int] -> Int 
psum n is = mapReduce n sum plus is </div>
</div>

<blockquote>
<p>Question: Is <code>psum</code> equivalent to <code>sum</code>?</p>
</blockquote>
</section>
<section id="proving-code-equivalence-sum-and-psum" class="level2">
<h2>Proving Code Equivalence: <code>sum</code> and <code>psum</code></h2>
<p>The equivalence proof is an instance of the higher order theorem <code>mRTheorem</code>:</p>
<div id="program-pane-6" class="welleditor" style="background:#fff; position:relative">

  <!-- Verify Source -->
  <button class="btn btn-xs btn-link actbutton" type="button" style="z-index:1"
          ng-show="isUnknown" ng-click="verifySource()">
    <span class="glyphicon glyphicon-play"></span>
  </button>
 
  <div id="program-6" class="programbox">{-@ sumEq :: n:Int -> is:[Int] -> { sum is == psum n is } @-}
sumEq :: Int -> [Int] -> ()
sumEq n is = mRTheorem   n           -- chunk size
                         sum         -- function to map-reduce
                         plus        -- reduction operator
                         plusRightId -- plus has "right-identity"
                         sumDistr    -- sum is "distributive"
                         is          -- input list</div>
</div>

<p>where <code>plusRightId</code> and <code>sumDistr</code> are the right-identity and distributive properties of <code>plus</code> and <code>sum</code> respectively and are proved by induction.</p>
<div id="program-pane-7" class="welleditor" style="background:#fff; position:relative">

  <!-- Verify Source -->
  <button class="btn btn-xs btn-link actbutton" type="button" style="z-index:1"
          ng-show="isUnknown" ng-click="verifySource()">
    <span class="glyphicon glyphicon-play"></span>
  </button>
 
  <div id="program-7" class="programbox">{-@ plusRightId :: xs:[Int] 
                -> { plus (sum xs) (sum []) == sum xs } @-}
plusRightId :: [Int] -> ()
plusRightId []     = ()
plusRightId (x:xs) = plusRightId xs

{-@ sumDistr :: xs:[Int] -> ys:[Int] 
             -> { sum (xs ++ ys) == plus (sum xs) (sum ys) } @-}
sumDistr :: [Int] -> [Int] -> ()
sumDistr []     _  = ()
sumDistr (x:xs) ys = sumDistr xs ys</div>
</div>

</section>
<section id="higher-order-map-reduce-theorem" class="level2">
<h2>Higher Order Map Reduce Theorem</h2>
<p>The higher order mapReduce theorem is also proved by induction calling the take-drop reconstruction property in the inductive case:</p>
<div id="program-pane-8" class="welleditor" style="background:#fff; position:relative">

  <!-- Verify Source -->
  <button class="btn btn-xs btn-link actbutton" type="button" style="z-index:1"
          ng-show="isUnknown" ng-click="verifySource()">
    <span class="glyphicon glyphicon-play"></span>
  </button>
 
  <div id="program-8" class="programbox">{-@ mRTheorem :: n:Int -> f:([a] -> b) -> op:(b -> b -> b)
     -> rightId:(xs:[a] -> {op (f xs) (f []) == f xs } ) 
     -> distrib:(xs:[a] -> ys:[a] 
                        -> {f (xs ++ ys) == op (f xs) (f ys)} )
     -> is:[a]
     -> { mapReduce n f op is == f is }
     / [len is]
  @-}
mRTheorem :: Int -> ([a] -> b) -> (b -> b -> b) -> ([a] -> ()) -> ([a] -> [a] -> ()) -> [a] -> ()
mRTheorem n f op rightId _ []
  = rightId []

mRTheorem n f op rightId _ is@(_:_)
  | n <= 1 || length is <= n 
  = rightId is

mRTheorem n f op rightId distrib is 
  = mRTheorem n f op rightId distrib (drop n is)
  ? distrib (take n is) (drop n is)
  ? appendTakeDrop n is </div>
</div>

</section>
<section id="summary" class="level2">
<h2>Summary</h2>
<p>Liquid Haskell can be used to prove theorems about Haskell functions. The theorems are expressed as refinements of the unit type and the proofs are Haskell functions that inhabit the theorems. Even though the proofs are not automatic, they can be simplified using PLE and the proof combinators library.</p>
</section>
<section id="missing-code" class="level2">
<h2>Missing Code</h2>
<div id="program-pane-9" class="welleditor" style="background:#fff; position:relative">

  <!-- Verify Source -->
  <button class="btn btn-xs btn-link actbutton" type="button" style="z-index:1"
          ng-show="isUnknown" ng-click="verifySource()">
    <span class="glyphicon glyphicon-play"></span>
  </button>
 
  <div id="program-9" class="programbox">{-@ chunk :: i:Int -> xs:[a] 
          -> [[a]] 
           / [len xs] @-}
chunk i xs 
  | i <= 1 || length xs <= i 
  = [xs] 
  | otherwise
  = take i xs:chunk i (drop i xs)


{-@ reflect length @-}
{-@ length :: xs:[a] -> {v:Nat | v == len xs} @-}
length :: [a] -> Int 
length []     = 0
length (_:xs) = 1 + length xs

{-@ reflect drop @-}
{-@ drop :: i:Nat -> xs:{[a] | i <= len xs } -> {v:[a] | len v == len xs - i } @-}
drop :: Int -> [a] -> [a]
drop i [] = []
drop i (x:xs)
  | i == 0 
  = x:xs  
  | otherwise 
  = drop (i-1) xs 

{-@ reflect take @-}
{-@ take :: i:Nat -> xs:{[a] | i <= len xs } -> {v:[a] | len v == i} @-} 
take :: Int -> [a] -> [a]
take i [] = []
take i (x:xs)
  | i == 0 
  = []
  | otherwise 
  = x:take (i-1) xs</div>
</div>

</section>
</section>

</div>
</div>

<div class="hidden">
<!--Site Meter -->
  <script type="text/javascript" src="//s23.sitemeter.com/js/counter.js?site=s23liquidtypes"></script>
  <noscript>
    <a href="http://s23.sitemeter.com/stats.asp?site=s23liquidtypes" 
      target="_top">
      <img src="http://s23.sitemeter.com/meter.asp?site=s23liquidtypes" 
      alt="Site Meter" border="0"/></a>
  </noscript>
  <!-- Copyright (c)2009 Site Meter -->
</div>





<!-- JavaScript below! ============================================== -->

  <script src="./js/ace/ace.js" type="text/javascript" charset="utf-8"></script> 
  <script src="./js/ace/theme-monokai.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/ace/mode-haskell.js"  type="text/javascript" charset="utf-8"></script>
  <script src="./js/liquid/tooltip.js"></script> 
  <script src="./js/liquid/annot.js"></script> 
  <script src="./js/liquid/config.js"></script> 
  <script src="./js/liquid/liquid.js"></script>

  <script type="text/javascript">
    var queryServerURL = "https://liquidhaskell.goto.ucsd.edu/" ;
  </script>
  
  <!-- rust nav JS --> 
  <script type="text/javascript">
    window.playgroundUrl = "";
  </script>
  
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {

 document.getElementById("toggle-nav").onclick = toggleNav;

  function toggleNav() {
    var toc         = document.getElementById("toc");
    var pagewrapper = document.getElementById("page-wrapper");
    var status      = document.getElementById("checker-status");

    toggleClass(toc,         "mobile-hidden");
    // toggleClass(status,      "mobile-hidden");
    toggleClass(pagewrapper, "mobile-hidden");
  };

  function toggleClass(el, className) {
     // from http://youmightnotneedjquery.com/
     if (el.classList) {
       el.classList.toggle(className);
     } else {
       var classes = el.className.split(' ');
       var existingIndex = classes.indexOf(className);

       if (existingIndex >= 0) {
         classes.splice(existingIndex, 1);
       } else {
         classes.push(className);
       }
       el.className = classes.join(' ');
     }
  }
});
</script>
</body>
</html>
